(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{4862:function(e,t,a){Promise.resolve().then(a.bind(a,5370))},5370:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var n=a(7437),l=a(2126),s=a(2265),i=a(9013),r=a(9429),c=a(6034),d=a(6565),o=a(7818),u=a(332),m=a(6300).Buffer;function x(){let{isOpen:e,onOpen:t,onOpenChange:x}=(0,i.q)(),[p,h]=(0,s.useState)(!1),[f,j]=(0,s.useState)(!1),[b,g]=(0,s.useState)(""),[v,y]=(0,s.useState)([]),[N,w]=(0,s.useState)([]),k=(0,o.default)(()=>Promise.all([a.e(733),a.e(212),a.e(858),a.e(171)]).then(a.bind(a,2795)),{loadableGenerated:{webpack:()=>[2795]},ssr:!1}),S=async e=>{try{await l.Z.get("/api/route/delete/".concat(e)),alert("刪除成功")}catch(e){console.error("刪除失敗",e),alert("刪除失敗，請稍後再試")}},C=(e,t)=>{let a=[{key:"item",label:"項次",value:t.item},{key:"name",label:"示範點名稱",value:t.name},{key:"map",label:"預覽",value:(0,n.jsx)(k,{data:_(t.name)})}];return g(t.name),"edit"===e&&a.splice(2,0,{key:"input",label:"GPX 匯入",value:(0,n.jsx)("input",{id:"editRouteFile",type:"file"},t.name)}),a},_=e=>[Z.find(t=>t.route_name===e)],[Z,A]=(0,s.useState)([]),E=()=>{l.Z.get("/api/route/getAll").then(e=>{A(e.data.data)})};(0,s.useEffect)(()=>{E()},[]);let O=()=>{let e=new FormData;document.getElementById("editRouteFile").files[0]&&e.append("file",document.getElementById("editRouteFile").files[0]),e.append("route_name",b||N.name),e.append("route_id",N.item);let t={headers:{"Content-Type":"multipart/form-data",Authorization:"Basic "+m.from("tycg_admin:TycGaDmIn2024").toString("base64")},params:{isNew:"false"}};l.Z.post("/api/route/save",e,t).then(e=>{alert("儲存成功"),E()})},z=(0,s.useMemo)(()=>Z.map(e=>({item:e.id,name:e.route_name})),[Z]),[F,P]=(0,s.useState)(""),[B,G]=(0,s.useState)();return(0,n.jsxs)("main",{children:[(0,n.jsxs)("div",{className:"flex flex-col items-center gap-4 my-5 max-w-[1280px] mx-auto",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{children:"示範點 GPX 路線一覽表"}),(0,n.jsx)(r.A,{className:"ml-4",color:"secondary",onClick:()=>{t(),P("")},children:"新增路線"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 justify-center gap-4 w-full",children:[(0,n.jsx)("div",{children:(0,n.jsx)(d.Z,{headers:["項次","示範點名稱","操作"],columns:z,isAction:!0,view:e=>{h(!0),j(!1),y(C("view",e))},edit:e=>{h(!0),j(!0),y(C("edit",e)),w(e)},delete:e=>{confirm("確定要刪除")&&S(e.item).then(e=>E())}})}),p&&(0,n.jsxs)("div",{className:"border border-default-100 rounded-[14px] shadow-md bg-white p-4",children:[v.map((e,t)=>(0,n.jsxs)("div",{className:"".concat(t===v.length-1&&"rounded-bl-lg rounded-br-lg"," ").concat(0===t&&"border-t rounded-tl-lg rounded-tr-lg"," flex items-center justify-center border-b border-r border-l"),children:[(0,n.jsx)("div",{className:"".concat(0===t&&"rounded-tl-lg"," ").concat(v.length-1===t&&"rounded-bl-lg"," w-[140px] text-sm py-2 px-8 bg-default-100 ").concat("map"===e.key&&"self-baseline"),children:e.label}),"name"===e.key&&f?(0,n.jsx)("div",{className:"flex-1 px-2",children:(0,n.jsx)(c.Y,{type:"text",labelPlacement:"outside-left",placeholder:"請輸入名稱",value:b,size:"sm",onChange:e=>g(e.target.value)})}):(0,n.jsx)("div",{className:"flex-1 text-center px-8 ".concat("map"===e.key&&"!p-1"),children:e.value})]},e.key)),(0,n.jsxs)("div",{className:"flex items-center justify-center mt-4",children:[f&&(0,n.jsx)(r.A,{className:"ml-4",color:"secondary",size:"sm",onClick:()=>O(),children:"完成並儲存"}),(0,n.jsx)(r.A,{className:"ml-4",color:"default",size:"sm",onClick:()=>h(!1),children:"關閉"})]})]})]})]}),(0,n.jsx)(u.Z,{data:{title:"新增路線"},isOpen:e,onOpenChange:x,submit:()=>{let e=new FormData;e.append("file",B),e.append("route_name",F);let t={headers:{"Content-Type":"multipart/form-data",Authorization:"Basic "+m.from("tycg_admin:TycGaDmIn2024").toString("base64")},params:{isNew:"true"}};l.Z.post("/api/route/save",e,t).then(e=>{alert("新增成功"),E()})},hasSubmit:"true",children:(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsx)(c.Y,{type:"text",label:"示範點名稱",labelPlacement:"outside-left",placeholder:"請輸入名稱",value:F,onChange:e=>P(e.target.value)}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm pr-3",children:"GPX 匯入"}),(0,n.jsx)("input",{className:"p-3 bg-default-100 rounded-xl",type:"file",onChange:e=>G(e.target.files[0])})]})]})})]})}},332:function(e,t,a){"use strict";a.d(t,{Z:function(){return x}});var n=a(7437);a(2265);var l=a(6648),s=a(4934),i=a(8731),r=a(5256),c=a(1025),d=a(7971),o=a(9429),u=a(3849),m=a(6565);function x(e){let t=(0,u.F)();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(s.R,{isOpen:e.isOpen,size:"mobile"===t?"xs":"2xl",placement:"mobile"===t?"top":"center",scrollBehavior:"inside",onOpenChange:e.onOpenChange,children:(0,n.jsx)(i.A,{children:t=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.k,{className:"flex flex-col gap-1",children:e.data.title}),(0,n.jsxs)(c.I,{children:[(0,n.jsx)("p",{dangerouslySetInnerHTML:{__html:e.data.content},className:"whitespace-pre-line"}),e.children,e.data.image&&(0,n.jsx)(l.default,{className:"w-full h-full",src:e.data.image,alt:"新聞稿圖片",width:0,height:0,sizes:"100vw",priority:!0}),e.data.table&&(0,n.jsx)(m.Z,{headers:e.data.table.headers,columns:e.data.table.columns,isStriped:!1})]}),(0,n.jsx)(d.R,{children:e.hasSubmit&&(0,n.jsx)(o.A,{color:"secondary",onPress:()=>{t(),e.submit()},children:"送出"})})]})})},e.data.title)})}},6565:function(e,t,a){"use strict";a.d(t,{Z:function(){return p}});var n=a(7437),l=a(5764),s=a(5693),i=a(7622),r=a(8724),c=a(929),d=a(2053),o=a(8382),u=a(9100),m=a(7022),x=a(1161);function p(e){var t;let a=t=>{let{column:a}=t;return(0,n.jsxs)("div",{className:"relative flex items-center gap-2",children:[(0,n.jsx)(r.e,{content:"檢視",children:(0,n.jsx)("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>e.view(a),children:(0,n.jsx)(l.Z,{})})}),(0,n.jsx)(r.e,{content:"編輯",children:(0,n.jsx)("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>e.edit(a),children:(0,n.jsx)(s.Z,{})})}),(0,n.jsx)(r.e,{content:"刪除",children:(0,n.jsx)("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>e.delete(a),children:(0,n.jsx)(i.Z,{})})})]})};return(0,n.jsxs)(c.b,{"aria-label":"Example static collection table",isStriped:null===(t=e.isStriped)||void 0===t||t,children:[(0,n.jsx)(d.J,{children:e.headers.map(e=>(0,n.jsx)(o.j,{className:"".concat(["第一場","第二場","第三場","數量合計"].includes(e)&&"text-center"," ").concat(["項次","示範點名稱"].includes(e)&&"text-sm"),children:e},e))}),e.isAction?(0,n.jsx)(u.y,{children:e.columns.map((e,t)=>(0,n.jsxs)(m.g,{children:[Object.keys(e).map(t=>(0,n.jsx)(x.X,{className:"".concat(["firstNumber","secondaryNumber","thirdNumber","totalNumber"].includes(t)&&"text-center"," ").concat(["name","item"].includes(t)&&"whitespace-nowrap"),children:e[t]},t)),(0,n.jsx)(x.X,{children:(0,n.jsx)(a,{column:e})},"action")]},t))}):(0,n.jsx)(u.y,{children:e.columns.map((e,t)=>(0,n.jsx)(m.g,{children:Object.keys(e).map(t=>(0,n.jsx)(x.X,{className:"".concat(["firstNumber","secondaryNumber","thirdNumber","totalNumber"].includes(t)&&"text-center"," ").concat(["name","item"].includes(t)&&"whitespace-nowrap"),children:e[t]},t))},t))})]})}},3849:function(e,t,a){"use strict";a.d(t,{F:function(){return l}});var n=a(2265);let l=()=>{let[e,t]=(0,n.useState)("");return(0,n.useEffect)(()=>{let e=()=>{t(window.innerWidth>=1024?"pc":window.innerWidth>=768?"tablet":"mobile")};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}}},function(e){e.O(0,[948,277,34,971,23,744],function(){return e(e.s=4862)}),_N_E=e.O()}]);